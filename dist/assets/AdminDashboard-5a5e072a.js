import{c as Ne,g as Sa,r as t,j as e,n as Me,k as _a,w as ka,R as Y,q as F,x as Fe,s as p,B as g,t as y,m as R,L as Pe,I as G}from"./index-398056f1.js";import{T as Se}from"./textarea-bd517421.js";import{C as Ie,g as qe,i as Be,S as _e,a as ke,b as Te,c as Re,d as Le}from"./select-0ae0f10d.js";import{T as Ta,a as Ra,b as W,c as H}from"./tabs-4e5bde91.js";import{c as Ve,T as La,O as Oa,W as za,C as Ua,a as $a,b as Ma,d as Ge,R as ye,P as Fa,e as le,f as de,g as me,h as pe,S as Oe,D as je,i as ze,j as Ia}from"./dialog-7d034cda.js";import{L as q}from"./label-5befe9e8.js";import{S as Ue}from"./shopping-bag-1514d0cf.js";import{P as qa,C as $e}from"./package-plus-f8825b3c.js";import{U as Ba}from"./users-f17fafd0.js";import{H as Va}from"./heart-8ddca09c.js";import{T as be}from"./trash-2-b64ae736.js";import{P as Ga}from"./pencil-60e0a76b.js";import"./index-815812cc.js";import"./index-ca2bc43f.js";import"./chevron-down-ba57ce6e.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=Ne("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=Ne("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=Ne("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var Ze="AlertDialog",[Ha,Cs]=Sa(Ze,[Ve]),z=Ve(),Ye=l=>{const{__scopeAlertDialog:r,...s}=l,o=z(r);return e.jsx(ye,{...o,...s,modal:!0})};Ye.displayName=Ze;var Za="AlertDialogTrigger",Je=t.forwardRef((l,r)=>{const{__scopeAlertDialog:s,...o}=l,n=z(s);return e.jsx(La,{...n,...o,ref:r})});Je.displayName=Za;var Ya="AlertDialogPortal",Ke=l=>{const{__scopeAlertDialog:r,...s}=l,o=z(r);return e.jsx(Fa,{...o,...s})};Ke.displayName=Ya;var Ja="AlertDialogOverlay",Qe=t.forwardRef((l,r)=>{const{__scopeAlertDialog:s,...o}=l,n=z(s);return e.jsx(Oa,{...n,...o,ref:r})});Qe.displayName=Ja;var Z="AlertDialogContent",[Ka,Qa]=Ha(Z),Xa=ka("AlertDialogContent"),Xe=t.forwardRef((l,r)=>{const{__scopeAlertDialog:s,children:o,...n}=l,v=z(s),f=t.useRef(null),x=Me(r,f),b=t.useRef(null);return e.jsx(za,{contentName:Z,titleName:ea,docsSlug:"alert-dialog",children:e.jsx(Ka,{scope:s,cancelRef:b,children:e.jsxs(Ua,{role:"alertdialog",...v,...n,ref:x,onOpenAutoFocus:_a(n.onOpenAutoFocus,E=>{var A;E.preventDefault(),(A=b.current)==null||A.focus({preventScroll:!0})}),onPointerDownOutside:E=>E.preventDefault(),onInteractOutside:E=>E.preventDefault(),children:[e.jsx(Xa,{children:o}),e.jsx(as,{contentRef:f})]})})})});Xe.displayName=Z;var ea="AlertDialogTitle",aa=t.forwardRef((l,r)=>{const{__scopeAlertDialog:s,...o}=l,n=z(s);return e.jsx($a,{...n,...o,ref:r})});aa.displayName=ea;var sa="AlertDialogDescription",ra=t.forwardRef((l,r)=>{const{__scopeAlertDialog:s,...o}=l,n=z(s);return e.jsx(Ma,{...n,...o,ref:r})});ra.displayName=sa;var es="AlertDialogAction",ta=t.forwardRef((l,r)=>{const{__scopeAlertDialog:s,...o}=l,n=z(s);return e.jsx(Ge,{...n,...o,ref:r})});ta.displayName=es;var la="AlertDialogCancel",ia=t.forwardRef((l,r)=>{const{__scopeAlertDialog:s,...o}=l,{cancelRef:n}=Qa(la,s),v=z(s),f=Me(r,n);return e.jsx(Ge,{...v,...o,ref:f})});ia.displayName=la;var as=({contentRef:l})=>{const r=`\`${Z}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Z}\` by passing a \`${sa}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Z}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return t.useEffect(()=>{var o;document.getElementById((o=l.current)==null?void 0:o.getAttribute("aria-describedby"))||console.warn(r)},[r,l]),null},ss=Ye,rs=Je,ts=Ke,oa=Qe,ca=Xe,na=ta,da=ia,ma=aa,pa=ra;const ce=ss,ne=rs,ls=ts,xa=Y.forwardRef(({className:l,...r},s)=>e.jsx(oa,{className:F("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",l),...r,ref:s}));xa.displayName=oa.displayName;const Q=Y.forwardRef(({className:l,...r},s)=>e.jsxs(ls,{children:[e.jsx(xa,{}),e.jsx(ca,{ref:s,className:F("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",l),...r})]}));Q.displayName=ca.displayName;const X=({className:l,...r})=>e.jsx("div",{className:F("flex flex-col space-y-2 text-center sm:text-left",l),...r});X.displayName="AlertDialogHeader";const ee=({className:l,...r})=>e.jsx("div",{className:F("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",l),...r});ee.displayName="AlertDialogFooter";const ae=Y.forwardRef(({className:l,...r},s)=>e.jsx(ma,{ref:s,className:F("text-lg font-semibold text-black",l),...r}));ae.displayName=ma.displayName;const se=Y.forwardRef(({className:l,...r},s)=>e.jsx(pa,{ref:s,className:F("text-sm text-gray-500",l),...r}));se.displayName=pa.displayName;const re=Y.forwardRef(({className:l,...r},s)=>e.jsx(na,{ref:s,className:F(Fe(),l),...r}));re.displayName=na.displayName;const te=Y.forwardRef(({className:l,...r},s)=>e.jsx(da,{ref:s,className:F(Fe({variant:"outline"}),"mt-2 sm:mt-0 border-gray-300 text-black hover:bg-gray-100",l),...r}));te.displayName=da.displayName;const is=async()=>{const{data:l,error:r}=await p.from("favorites").select("product_id");if(r)return console.error("Error fetching favorites:",r),[];const s={};l.forEach(x=>{s[x.product_id]=(s[x.product_id]||0)+1});const o=Object.entries(s).sort((x,b)=>b[1]-x[1]).slice(0,5),n=o.map(([x])=>parseInt(x)),{data:v,error:f}=await p.from("products").select("id, name").in("id",n);return f?(console.error("Error fetching product details:",f),[]):o.map(([x,b])=>{const E=v.find(A=>A.id===parseInt(x));return{name:E?E.name:`Producto ID ${x}`,count:b}})},os=({isOpen:l,setIsOpen:r,onSuccess:s})=>{const[o,n]=t.useState(""),[v,f]=t.useState(""),[x,b]=t.useState(null),[E,A]=t.useState(1),[B,L]=t.useState({x:0,y:0}),[J,_]=t.useState(null),[T,N]=t.useState(!1),[S,I]=t.useState(!1),U=C=>{const h=C.target.files[0];if(!h)return;const m=new FileReader;m.onload=()=>b(m.result),m.readAsDataURL(h)},d=t.useCallback((C,h)=>{_(h)},[]),u=async()=>{N(!0);try{const C=await qe(x,J),h=await Be(C,{maxSizeMB:.2,maxWidthOrHeight:800,fileType:"image/webp"}),m=`categoria-${Date.now()}.webp`,{error:P}=await p.storage.from("categorias").upload(m,h,{contentType:"image/webp"});if(P){console.error("Error subiendo imagen:",P);return}const{data:K}=p.storage.from("categorias").getPublicUrl(m),{data:$,error:M}=await p.from("categorias").insert([{title:o,description:v,image_url:K.publicUrl,categoria:o.toLowerCase().replace(/\s+/g,"-"),filter:o.toLowerCase().replace(/\s+/g,"-")}]).select().single();if(M){console.error("Error creando categoría:",M);return}s==null||s($),I(!0),setTimeout(()=>{I(!1),r(!1)},1200),n(""),f(""),b(null),A(1)}catch(C){console.error("Error general:",C)}finally{N(!1)}};return e.jsx(ye,{open:l,onOpenChange:r,children:e.jsxs(le,{className:"max-w-xl",children:[e.jsxs(de,{children:[e.jsx(me,{children:"Crear Nueva Categoría"}),e.jsx(pe,{children:"Rellena los campos para añadir una categoría nueva."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx("input",{type:"text",placeholder:"Título",value:o,onChange:C=>n(C.target.value),className:"w-full border px-3 py-2 rounded"}),e.jsx("textarea",{placeholder:"Descripción",value:v,onChange:C=>f(C.target.value),className:"w-full border px-3 py-2 rounded"}),x?e.jsx("div",{className:"relative w-full h-60 bg-gray-100 rounded overflow-hidden",children:e.jsx(Ie,{image:x,crop:B,zoom:E,aspect:1/1,onCropChange:L,onCropComplete:d,onZoomChange:A})}):e.jsx("input",{type:"file",accept:"image/*",onChange:U}),x&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Zoom"}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:E,onChange:C=>A(Number(C.target.value)),className:"w-full"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2 items-center",children:[e.jsx(g,{variant:"outline",onClick:()=>r(!1),disabled:T,children:"Cancelar"}),e.jsxs(g,{onClick:u,disabled:T||!o||!v||!x,children:[T?e.jsx(He,{className:"animate-spin w-4 h-4 mr-2"}):S?e.jsx(We,{className:"text-green-500 w-4 h-4 mr-2"}):null,S?"Creado":T?"Creando...":"Crear Categoría"]})]})]})})},cs=({isOpen:l,setIsOpen:r,category:s,onSuccess:o})=>{const[n,v]=t.useState((s==null?void 0:s.title)||""),[f,x]=t.useState((s==null?void 0:s.description)||""),[b,E]=t.useState(null),[A,B]=t.useState(1),[L,J]=t.useState({x:0,y:0}),[_,T]=t.useState(null),[N,S]=t.useState(!1),[I,U]=t.useState(!1);t.useEffect(()=>{v((s==null?void 0:s.title)||""),x((s==null?void 0:s.description)||"")},[s]);const d=h=>{const m=h.target.files[0];if(!m)return;const P=new FileReader;P.onload=()=>E(P.result),P.readAsDataURL(m)},u=t.useCallback((h,m)=>{T(m)},[]),C=async()=>{S(!0);try{let h=s.image_url;if(b){const P=await qe(b,_),K=await Be(P,{maxSizeMB:.2,maxWidthOrHeight:800,fileType:"image/webp"}),$=`categoria-${Date.now()}.webp`,{error:M}=await p.storage.from("categorias").upload($,K,{contentType:"image/webp"});if(M){console.error("Error subiendo imagen:",M);return}const{data:ie}=p.storage.from("categorias").getPublicUrl($);h=ie.publicUrl}const{error:m}=await p.from("categorias").update({title:n,description:f,image_url:h,categoria:n.toLowerCase().replace(/\s+/g,"-"),filter:n.toLowerCase().replace(/\s+/g,"-")}).eq("id",s.id);if(m){console.error("Error actualizando categoría:",m);return}await p.from("products").update({category_name:n}).eq("category_id",s.id),o==null||o(),U(!0),setTimeout(()=>{U(!1),r(!1)},1200)}catch(h){console.error("Error general:",h)}finally{S(!1)}};return e.jsx(ye,{open:l,onOpenChange:r,children:e.jsxs(le,{className:"max-w-xl",children:[e.jsxs(de,{children:[e.jsx(me,{children:"Editar Categoría"}),e.jsx(pe,{children:"Modifica la categoría y guarda los cambios."})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx("input",{type:"text",placeholder:"Título",value:n,onChange:h=>v(h.target.value),className:"w-full border px-3 py-2 rounded"}),e.jsx("textarea",{placeholder:"Descripción",value:f,onChange:h=>x(h.target.value),className:"w-full border px-3 py-2 rounded"}),b?e.jsx("div",{className:"relative w-full h-60 bg-gray-100 rounded overflow-hidden",children:e.jsx(Ie,{image:b,crop:L,zoom:A,aspect:1/1,onCropChange:J,onCropComplete:u,onZoomChange:B})}):e.jsx("input",{type:"file",accept:"image/*",onChange:d}),b&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Zoom"}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:A,onChange:h=>B(Number(h.target.value)),className:"w-full"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2 items-center",children:[e.jsx(g,{variant:"outline",onClick:()=>r(!1),disabled:N,children:"Cancelar"}),e.jsxs(g,{onClick:C,disabled:N||!n||!f,children:[N?e.jsx(He,{className:"animate-spin w-4 h-4 mr-2"}):I?e.jsx(We,{className:"text-green-500 w-4 h-4 mr-2"}):null,I?"Actualizado":N?"Guardando...":"Guardar Cambios"]})]})]})})},Ds=()=>{const[l,r]=t.useState([]),[s,o]=t.useState([]),[n,v]=t.useState([]),[f,x]=t.useState([]),[b,E]=t.useState(""),[A,B]=t.useState(""),[L,J]=t.useState(""),[_,T]=t.useState(null),[N,S]=t.useState({user_email:"",name:"",description:"",status:"En preparación"}),[I,U]=t.useState(!1),[d,u]=t.useState(!0),[C,h]=t.useState("dashboard"),[m,P]=t.useState(null),[K,$]=t.useState(!1),M=["En preparación","Enviado","Finalizada"],[ie,ha]=t.useState([]),[ve,xe]=t.useState(!1),ua=()=>xe(!0),[we,he]=t.useState([]),[Ce,De]=t.useState(null);t.useEffect(()=>{(async()=>{const i=await is();ha(i)})()},[]),t.useEffect(()=>{const i=new URLSearchParams(window.location.search).get("tab");i&&h(i),oe()},[]);const oe=async()=>{u(!0);const{data:a,error:i}=await p.from("profiles").select("id, name, email, phone, purchase_count, points");if(i){console.error(i),y({title:"Error",description:"No se pudieron cargar los perfiles.",variant:"destructive"}),u(!1);return}const{data:c,error:j}=await p.from("favorites").select("user_id, product_id, products(name)");if(j){console.error(j),u(!1);return}const{data:w,error:D}=await p.from("categorias").select("*").order("fijada",{ascending:!1}).order("created_at",{ascending:!1});D?(console.error(D),y({title:"Error",description:"No se pudieron cargar las categorías.",variant:"destructive"})):he(w);const k={};c.forEach(O=>{var Ae;k[O.user_id]||(k[O.user_id]=[]),k[O.user_id].push({id:O.product_id,name:((Ae=O.products)==null?void 0:Ae.name)||"Sin nombre"})});const V=a.map(O=>({...O,favorites_list:k[O.id]||[],favorites_count:(k[O.id]||[]).length}));r(V);const[{data:Ea},{data:Aa},{data:Pa}]=await Promise.all([p.from("products").select("*,categorias (categoria)").order("created_at",{ascending:!1}),p.from("purchases").select("*").order("created_at",{ascending:!1}),p.from("reviews").select("*").order("created_at",{ascending:!1})]);o(Ea||[]),v(Aa||[]),x(Pa||[]),u(!1)},ga=()=>{const a=[["Nombre","Email","Teléfono","Puntos","Compras","Favoritos"],...l.map(w=>[w.name,w.email,w.phone,w.points??0,w.purchase_count??0,w.favorites_list.map(D=>`${D.name} (${D.id})`).join(" | ")])].map(w=>w.map(D=>`"${D}"`).join(",")).join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(i),j=document.createElement("a");j.href=c,j.setAttribute("download","usuarios.csv"),document.body.appendChild(j),j.click(),document.body.removeChild(j)},ue=l.filter(a=>a.name&&a.name.toLowerCase().includes(b.toLowerCase())||a.email&&a.email.toLowerCase().includes(b.toLowerCase())),ge=s.filter(a=>a.name&&a.name.toLowerCase().includes(A.toLowerCase())||a.category&&a.category.toLowerCase().includes(A.toLowerCase())),fe=n.filter(a=>a.userName&&a.userName.toLowerCase().includes(L.toLowerCase())||a.user_email&&a.user_email.toLowerCase().includes(L.toLowerCase())||a.name&&a.name.toLowerCase().includes(L.toLowerCase())||a.status&&a.status.toLowerCase().includes(L.toLowerCase())),Ee=(a=null)=>{a?(T(a),S({user_email:a.email,name:"",description:"",status:"En preparación"})):(T(null),S({user_email:"",name:"",description:"",status:"En preparación"})),U(!0)},fa=async()=>{u(!0);const a=_?_.email:N.user_email;if(!a||!N.name){y({title:"Campos incompletos",description:"El email del usuario y el nombre de la compra son obligatorios.",variant:"destructive"}),u(!1);return}let i=_?_.id:null;if(!i){const{data:w,error:D}=await p.from("profiles").select("id").eq("email",a).single();if(D){console.error("Error obteniendo perfil:",D),y({title:"Error",description:"No se pudo obtener el ID de usuario.",variant:"destructive"}),u(!1);return}i=w.id}const{data:c,error:j}=await p.from("purchases").insert([{...N,user_email:a,user_id:i}]).select("*, profiles(name)").single();j?y({title:"Error al crear compra",description:j.message,variant:"destructive"}):c&&(v(w=>{var D;return[{...c,userName:((D=c.profiles)==null?void 0:D.name)||c.user_email.split("@")[0]},...w]}),y({title:"Compra Creada",description:`La compra "${c.name}" ha sido creada para ${a}.`}),U(!1),S({user_email:"",name:"",description:"",status:"En preparación"}),T(null)),u(!1)},ja=async a=>{u(!0);const{error:i}=await p.from("purchases").delete().eq("id",a);i?y({title:"Error al eliminar compra",description:i.message,variant:"destructive"}):(v(c=>c.filter(j=>j.id!==a)),y({title:"Compra Eliminada"})),u(!1)},ba=async()=>{if(!m||!m.id)return;u(!0);const{error:a}=await p.from("purchases").update({name:m.name,description:m.description,status:m.status}).eq("id",m.id);a?y({title:"Error al editar compra",description:a.message,variant:"destructive"}):(v(i=>i.map(c=>c.id===m.id?{...c,...m}:c)),y({title:"Compra Actualizada"}),$(!1),P(null)),u(!1)},Na=async a=>{u(!0);const{error:i}=await p.from("favorites").delete().eq("product_id",a);if(i)throw i;const{data:c,error:j}=await p.from("reviews").select("id, image_urls").eq("product_id",a);if(j)throw j;for(const k of c||[])if(k.image_urls&&Array.isArray(k.image_urls)){const{error:V}=await p.storage.from("reviews").remove(k.image_urls);V&&console.warn("Error al borrar imágenes:",V.message)}const{error:w}=await p.from("reviews").delete().eq("product_id",a);if(w)throw w;const{error:D}=await p.from("products").delete().eq("id",a);D?y({title:"Error al eliminar producto",description:D.message,variant:"destructive"}):(o(k=>k.filter(V=>V.id!==a)),y({title:"Producto Eliminado"})),u(!1)},ya=async a=>{u(!0);const{error:i}=await p.from("reviews").delete().eq("id",a);i?y({title:"Error al eliminar reseña",description:i.message,variant:"destructive"}):(x(c=>c.filter(j=>j.id!==a)),y({title:"Reseña Eliminada"})),u(!1)},va=a=>{De(a)},wa=async a=>{const i=!a.visible,{error:c}=await p.from("categorias").update({visible:i}).eq("id",a.id);c||(await p.from("products").update({visible:i}).eq("category_id",a.id),oe(),y({title:"Categoría actualizada",description:`Ahora está ${i?"visible":"oculta"}.`}))},Ca=async a=>{const i=!a.fijada,{error:c}=await p.from("categorias").update({fijada:i}).eq("id",a.id);c||(oe(),y({title:"Prioridad actualizada",description:i?"Categoría fijada":"Categoría desfijada"}))},Da=async a=>{u(!0);const{error:i}=await p.from("categorias").delete().eq("id",a);i?y({title:"Error al eliminar categoría",description:i.message,variant:"destructive"}):(he(c=>c.filter(j=>j.id!==a)),y({title:"Categoría Eliminada"})),u(!1)};return d&&l.length===0&&s.length===0&&n.length===0&&f.length===0?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-black"})}):e.jsxs("div",{className:"min-h-screen py-8 px-4 sm:px-6 lg:px-8 bg-gray-100",children:[e.jsxs(R.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-8 gap-4",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-semibold text-black text-center sm:text-left",children:"Dashboard de Administrador"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(g,{onClick:()=>Ee(),className:"bg-blue-600 text-white hover:bg-blue-700 flex-1 sm:flex-initial",children:[e.jsx(Ue,{className:"mr-2 h-5 w-5"})," Crear Compra"]}),e.jsx(Pe,{to:"/admin/crear-producto",className:"flex-1 sm:flex-initial",children:e.jsxs(g,{className:"bg-black text-white hover:bg-gray-800 w-full",children:[e.jsx(qa,{className:"mr-2 h-5 w-5"})," Crear Producto"]})}),e.jsx(g,{variant:"outline",onClick:ua,children:"Crear Categoría"})]})]}),e.jsxs(Ta,{value:C,onValueChange:h,className:"mb-6",children:[e.jsxs(Ra,{className:"grid grid-cols-1 sm:grid-cols-6 gap-2 p-2 rounded sm:bg-gray-200",children:[e.jsx(W,{value:"dashboard",children:"Dashboard"}),e.jsx(W,{value:"users",children:"Usuarios"}),e.jsx(W,{value:"products",children:"Productos"}),e.jsx(W,{value:"categories",children:"Categorías"}),e.jsx(W,{value:"purchases",children:"Compras"}),e.jsx(W,{value:"reviews",children:"Reseñas"})]}),e.jsxs("div",{className:"mt-[200px] sm:mt-2 flex flex-col gap-6 sm:gap-2 px-4",children:[e.jsxs(H,{value:"dashboard",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs(R.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1},className:"bg-white p-6 shadow border border-gray-200",children:[e.jsxs("div",{className:"flex items-center text-black mb-3",children:[e.jsx(Ba,{className:"h-7 w-7 mr-3",strokeWidth:1.5}),e.jsx("h2",{className:"text-xl font-semibold",children:"Usuarios Registrados"})]}),e.jsx("p",{className:"text-4xl font-bold text-black",children:l.length})]}),e.jsxs(R.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2},className:"bg-white p-6 shadow border border-gray-200",children:[e.jsxs("div",{className:"flex items-center text-black mb-3",children:[e.jsx(Ue,{className:"h-7 w-7 mr-3",strokeWidth:1.5}),e.jsx("h2",{className:"text-xl font-semibold",children:"Total de Compras"})]}),e.jsx("p",{className:"text-4xl font-bold text-black",children:n.length})]}),e.jsxs(R.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.3},className:"bg-white p-6 shadow border border-gray-200",children:[e.jsxs("div",{className:"flex items-center text-black mb-3",children:[e.jsx(Oe,{className:"h-7 w-7 mr-3",strokeWidth:1.5}),e.jsx("h2",{className:"text-xl font-semibold",children:"Total de Reseñas"})]}),e.jsx("p",{className:"text-4xl font-bold text-black",children:f.length})]})]}),e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white p-6 shadow border border-gray-200 mb-8",children:[e.jsxs("div",{className:"flex items-center text-black mb-3",children:[e.jsx(Va,{className:"h-7 w-7 mr-3",strokeWidth:1.5}),e.jsx("h2",{className:"text-xl font-semibold",children:"Productos Más Populares (Top 5)"})]}),e.jsx("ul",{children:ie.length===0?e.jsx("li",{children:"Cargando productos..."}):ie.map(({name:a,count:i})=>e.jsxs("li",{className:"mb-2",children:[e.jsx("span",{className:"font-medium",children:a})," — ",i," favoritos"]},a))})]})]}),e.jsx(H,{value:"users",children:e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white p-6 shadow border border-gray-200 mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-black mb-2 sm:mb-0",children:"Gestión de Usuarios"}),e.jsx(g,{size:"sm",onClick:ga,className:"bg-green-600 text-white hover:bg-green-700",children:"Exportar CSV"})]}),e.jsx("div",{className:"mb-4 flex",children:e.jsx(G,{type:"search",placeholder:"Buscar usuario por nombre o email...",value:b,onChange:a=>E(a.target.value),className:"max-w-sm mr-2 border-gray-300 focus:border-black focus:ring-black"})}),d&&ue.length===0?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-black"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Nombre"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Teléfono"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Nº Compras"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Favoritos"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Puntos"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Acciones"})]})}),e.jsx("tbody",{children:ue.map(a=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:a.name||"N/A"}),e.jsx("td",{className:"px-6 py-4",children:a.email}),e.jsx("td",{className:"px-6 py-4",children:a.phone||"-"}),e.jsx("td",{className:"px-6 py-4",children:a.purchase_count||0}),e.jsx("td",{className:"px-6 py-4",children:a.favorites_list.length===0?"—":e.jsx("ul",{className:"list-disc list-inside text-xs text-gray-700",children:a.favorites_list.map(i=>e.jsxs("li",{children:[i.name," (",i.id,")"]},i.id))})}),e.jsx("td",{className:"px-6 py-4",children:a.points??0}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>Ee(a),className:"text-xs text-blue-600 border-blue-600 hover:bg-blue-100",disabled:d,children:[e.jsx($e,{className:"h-3 w-3 mr-1"})," Añadir Compra"]})})]},a.id))})]}),ue.length===0&&!d&&e.jsx("p",{className:"text-center py-4 text-gray-500",children:"No se encontraron usuarios."})]})]})}),e.jsx(H,{value:"products",children:e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white p-6 shadow border border-gray-200 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-black mb-6",children:"Gestión de Productos"}),e.jsx("div",{className:"mb-4 flex",children:e.jsx(G,{type:"search",placeholder:"Buscar producto por nombre o categoría...",value:A,onChange:a=>B(a.target.value),className:"max-w-sm mr-2 border-gray-300 focus:border-black focus:ring-black"})}),d&&ge.length===0?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-black"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Nombre"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Categoría"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Precio"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Acciones"})]})}),e.jsx("tbody",{children:ge.map(a=>{var i;return e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:a.name}),e.jsx("td",{children:((i=a.categorias)==null?void 0:i.categoria)||"Sin categoría"}),e.jsx("td",{className:"px-6 py-4",children:(()=>{try{const c=typeof a.price=="string"?JSON.parse(a.price):a.price;return(c==null?void 0:c.type)==="fixed"?c.value||c.fixedPrice:"var"}catch{return"var"}})()}),e.jsxs("td",{className:"px-6 py-4 flex space-x-2",children:[e.jsx(Pe,{to:`/productos/${a.id}`,children:e.jsx(g,{variant:"ghost",size:"sm",className:"text-blue-600 hover:bg-blue-100 p-1.5",disabled:d,children:e.jsx(Wa,{className:"h-4 w-4"})})}),e.jsxs(ce,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 p-1.5",disabled:d,children:e.jsx(be,{className:"h-4 w-4"})})}),e.jsxs(Q,{children:[e.jsxs(X,{children:[e.jsx(ae,{children:"¿Estás seguro?"}),e.jsxs(se,{children:['Esta acción no se puede deshacer. Esto eliminará permanentemente el producto "',a.name,'".']})]}),e.jsxs(ee,{children:[e.jsx(te,{children:"Cancelar"}),e.jsxs(re,{onClick:()=>Na(a.id),className:"bg-red-600 hover:bg-red-700",children:[d?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):null,"Eliminar"]})]})]})]})]})]},a.id)})})]}),ge.length===0&&!d&&e.jsx("p",{className:"text-center py-4 text-gray-500",children:"No se encontraron productos."})]})]})}),e.jsx(H,{value:"purchases",children:e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white p-6 shadow border border-gray-200 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-black mb-6",children:"Gestión de Compras"}),e.jsx("div",{className:"mb-4 flex",children:e.jsx(G,{type:"search",placeholder:"Buscar compra...",value:L,onChange:a=>J(a.target.value),className:"max-w-sm mr-2 border-gray-300 focus:border-black focus:ring-black"})}),d&&fe.length===0?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-black"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Nombre Compra"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Usuario"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Email Usuario"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Estado"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Fecha"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Acciones"})]})}),e.jsx("tbody",{children:fe.map(a=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:a.name}),e.jsx("td",{className:"px-6 py-4",children:a.userName}),e.jsx("td",{className:"px-6 py-4",children:a.user_email}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${a.status==="En preparación"?"bg-yellow-100 text-yellow-800":a.status==="Enviado"?"bg-blue-100 text-blue-800":a.status==="Finalizada"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.status})}),e.jsx("td",{className:"px-6 py-4",children:new Date(a.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",className:"border-blue-600 text-blue-600 hover:bg-blue-50 flex items-center gap-1",onClick:()=>{P(a),$(!0)},disabled:d,children:e.jsx(Ga,{className:"w-4 h-4"})}),e.jsxs(ce,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 p-1.5",disabled:d,children:e.jsx(be,{className:"h-4 w-4"})})}),e.jsxs(Q,{children:[e.jsxs(X,{children:[e.jsx(ae,{children:"¿Estás seguro?"}),e.jsxs(se,{children:['Esta acción no se puede deshacer. Esto eliminará permanentemente la compra "',a.name,'".']})]}),e.jsxs(ee,{children:[e.jsx(te,{children:"Cancelar"}),e.jsxs(re,{onClick:()=>ja(a.id),className:"bg-red-600 hover:bg-red-700",children:[d&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Eliminar"]})]})]})]})]})})]},a.id))})]}),fe.length===0&&!d&&e.jsx("p",{className:"text-center py-4 text-gray-500",children:"No se encontraron compras."})]})]})}),e.jsx(H,{value:"reviews",children:e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white p-6 shadow border border-gray-200 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-black mb-6",children:"Gestión de Reseñas"}),d&&f.length===0?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-black"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm text-left text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Usuario"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Producto"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Puntuación"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Fecha"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Acciones"})]})}),e.jsx("tbody",{children:f.map(a=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:a.userName}),e.jsxs("td",{className:"px-6 py-4",children:[a.productName," (ID: ",a.product_id,")"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex",children:[...Array(5)].map((i,c)=>e.jsx(Oe,{className:`h-4 w-4 ${c<a.rating?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},c))})}),e.jsx("td",{className:"px-6 py-4",children:new Date(a.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs(ce,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 p-1.5",disabled:d,children:e.jsx(be,{className:"h-4 w-4"})})}),e.jsxs(Q,{children:[e.jsxs(X,{children:[e.jsx(ae,{children:"¿Estás seguro?"}),e.jsx(se,{children:"Esta acción no se puede deshacer. Esto eliminará permanentemente la reseña."})]}),e.jsxs(ee,{children:[e.jsx(te,{children:"Cancelar"}),e.jsxs(re,{onClick:()=>ya(a.id),className:"bg-red-600 hover:bg-red-700",children:[d?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):null,"Eliminar"]})]})]})]})})]},a.id))})]}),f.length===0&&!d&&e.jsx("p",{className:"text-center py-4 text-gray-500",children:"No se encontraron reseñas."})]})]})}),e.jsxs(H,{value:"categories",children:[e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white p-6 shadow border border-gray-200 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-black mb-6",children:"Gestión de Categorías"}),we.length===0?e.jsx("p",{className:"text-gray-500",children:"No hay categorías."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:we.map(a=>e.jsxs("div",{className:"border p-4 bg-white shadow-sm rounded",children:[e.jsx("img",{src:a.image_url,alt:a.title,className:"w-full h-40 object-cover rounded mb-2"}),e.jsx("h3",{className:"text-lg font-semibold",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.description}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(g,{size:"sm",onClick:()=>va(a),children:"Editar"}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>wa(a),children:a.visible?"Ocultar":"Mostrar"}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Ca(a),children:a.fijada?"Desfijar":"Fijar"}),e.jsxs(ce,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(g,{size:"sm",variant:"destructive",children:"Eliminar"})}),e.jsxs(Q,{children:[e.jsxs(X,{children:[e.jsx(ae,{children:"¿Eliminar categoría?"}),e.jsx(se,{children:"Esto la eliminará permanentemente."})]}),e.jsxs(ee,{children:[e.jsx(te,{children:"Cancelar"}),e.jsx(re,{onClick:()=>Da(a.id),children:"Eliminar"})]})]})]})]})]},a.id))})]}),e.jsx(cs,{isOpen:!!Ce,setIsOpen:()=>De(null),category:Ce,onSuccess:()=>oe()})]})]})]})]}),e.jsx(je,{open:I,onOpenChange:U,children:e.jsxs(le,{className:"sm:max-w-[425px] bg-white",children:[e.jsxs(de,{children:[e.jsx(me,{children:"Crear Nueva Compra"}),e.jsx(pe,{children:_?`Añadir compra para ${_.name||_.email}.`:"Completa los detalles de la nueva compra."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[!_&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"purchase-user-email",className:"text-right",children:"Email Usuario"}),e.jsx(G,{id:"purchase-user-email",type:"email",value:N.user_email,onChange:a=>S({...N,user_email:a.target.value}),className:"col-span-3 border-gray-300 focus:border-black focus:ring-black",placeholder:"email@ejemplo.com",disabled:d})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"purchase-name",className:"text-right",children:"Nombre Compra"}),e.jsx(G,{id:"purchase-name",value:N.name,onChange:a=>S({...N,name:a.target.value}),className:"col-span-3 border-gray-300 focus:border-black focus:ring-black",placeholder:"Ej: Pedido Especial San Valentín",disabled:d})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"purchase-description",className:"text-right",children:"Descripción"}),e.jsx(Se,{id:"purchase-description",value:N.description,onChange:a=>S({...N,description:a.target.value}),className:"col-span-3 border-gray-300 focus:border-black focus:ring-black",placeholder:"Detalles del pedido...",disabled:d})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"purchase-status",className:"text-right",children:"Estado"}),e.jsxs(_e,{value:N.status,onValueChange:a=>S({...N,status:a}),disabled:d,children:[e.jsx(ke,{className:"col-span-3 border-gray-300 focus:border-black focus:ring-black",children:e.jsx(Te,{placeholder:"Selecciona un estado"})}),e.jsx(Re,{children:M.map(a=>e.jsx(Le,{value:a,children:a},a))})]})]})]}),e.jsxs(ze,{children:[e.jsx(Ia,{asChild:!0,children:e.jsx(g,{type:"button",variant:"outline",className:"border-gray-300 text-black hover:bg-gray-100",disabled:d,children:"Cancelar"})}),e.jsxs(g,{type:"button",onClick:fa,className:"bg-black text-white hover:bg-gray-800",disabled:d,children:[d?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx($e,{className:"mr-2 h-4 w-4"})," Crear Compra"]})]})]})}),e.jsx(je,{open:K,onOpenChange:$,children:e.jsxs(le,{children:[e.jsxs(de,{children:[e.jsx(me,{children:"Editar Compra"}),e.jsx(pe,{children:"Modifica los datos de la compra seleccionada."})]}),m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Nombre"}),e.jsx(G,{value:m.name,onChange:a=>P({...m,name:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Descripción"}),e.jsx(Se,{value:m.description||"",onChange:a=>P({...m,description:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Estado"}),e.jsxs(_e,{value:m.status,onValueChange:a=>P({...m,status:a}),children:[e.jsx(ke,{className:"w-full",children:e.jsx(Te,{placeholder:"Seleccionar estado"})}),e.jsx(Re,{children:M.map(a=>e.jsx(Le,{value:a,children:a},a))})]})]})]}),e.jsx(ze,{children:e.jsx(g,{onClick:ba,disabled:d,children:"Guardar Cambios"})})]})}),e.jsx(je,{open:ve,onOpenChange:xe,children:e.jsx(le,{children:e.jsx(os,{isOpen:ve,setIsOpen:xe,onSuccess:a=>{he(i=>[...i,a])}})})})]})};export{Ds as default};
