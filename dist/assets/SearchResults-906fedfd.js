import{a as q,v as E,r as l,u as S,j as s,m as b,S as _,B as j,L as N,s as p,t as u}from"./index-7f1f9d48.js";import{A as P}from"./arrow-left-22413aa0.js";import{H as L}from"./heart-4e0712cb.js";const w=[],x=o=>o.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),A=o=>{try{const i=typeof o=="string"?JSON.parse(o):o;return(i==null?void 0:i.type)==="fixed"?`${i.value||i.fixedPrice} €`:"var"}catch{return"var"}},B=()=>{const[o]=q(),i=E(),h=o.get("q")||"",[f,k]=l.useState([]),[v,d]=l.useState([]),{user:n}=S(),[y,m]=l.useState(!1);l.useEffect(()=>{const e=x(h),r=w.filter(t=>{const a=x(t.name),c=x(t.category||""),g=x(t.description||"");return a.includes(e)||c.includes(e)||g.includes(e)});k(r)},[h]),l.useEffect(()=>{(async()=>{if(n){m(!0);const{data:r,error:t}=await p.from("favorites").select("product_id").eq("user_id",n.id);t?console.error("Error fetching favorites:",t):d(r.map(a=>a.product_id)),m(!1)}else d([])})()},[n]);const F=async e=>{var t;if(!n){u({title:"Inicia sesión",description:"Debes iniciar sesión para añadir a favoritos.",variant:"destructive"});return}m(!0);const r=v.includes(e);if(r){const{error:a}=await p.from("favorites").delete().eq("user_id",n.id).eq("product_id",e);a?u({title:"Error",description:a.message,variant:"destructive"}):d(c=>c.filter(g=>g!==e))}else{const{error:a}=await p.from("favorites").insert([{user_id:n.id,product_id:e}]);a?u({title:"Error",description:a.message,variant:"destructive"}):d(c=>[...c,e])}u({title:r?"Eliminado de Favoritos":"Añadido a Favoritos",description:(t=w.find(a=>a.id===e))==null?void 0:t.name}),m(!1)};return s.jsx("div",{className:"min-h-screen py-12 bg-white text-black",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[s.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-12",children:[s.jsx(_,{className:"h-10 w-10 mx-auto mb-3 text-black",strokeWidth:2}),s.jsxs("h1",{className:"text-3xl font-semibold mb-2",children:['Resultados de Búsqueda para "',h,'"']}),s.jsxs("p",{className:"text-gray-500",children:[f.length," producto(s) encontrado(s)."]}),s.jsxs(j,{variant:"outline",onClick:()=>i("/productos"),className:"mt-4 border-black text-black hover:bg-black hover:text-white",children:[s.jsx(P,{className:"mr-2 h-4 w-4"})," Volver a Productos"]})]}),f.length>0?s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-6 gap-y-10",children:f.map((e,r)=>{var t;return s.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.05},className:"group relative",children:[s.jsxs("div",{className:"relative w-full aspect-square bg-gray-100 overflow-hidden rounded",children:[s.jsx(N,{to:`/productos/${e.id}`,children:s.jsx("img",{className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",alt:e.imageAlt||e.name,src:((t=e.image_urls)==null?void 0:t[0])||"https://images.unsplash.com/photo-1635865165118-917ed9e20936"})}),s.jsx(j,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 bg-white/70 hover:bg-white text-black rounded-full h-8 w-8",onClick:()=>F(e.id),disabled:y,children:y&&v.includes(e.id)?s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-gray-500"}):s.jsx(L,{className:`h-4 w-4 ${v.includes(e.id)?"fill-red-500 text-red-500":"text-gray-500"}`,strokeWidth:1.5})})]}),s.jsxs("div",{className:"mt-3 text-center",children:[s.jsx("h3",{className:"text-md font-medium text-black",children:s.jsx(N,{to:`/productos/${e.id}`,children:e.name})}),s.jsx("p",{className:"mt-1 text-sm text-gray-500",children:A(e.price)})]})]},e.id)})}):s.jsx("div",{className:"text-center py-12",children:s.jsx("p",{className:"text-lg text-gray-500",children:"No se encontraron productos que coincidan con tu búsqueda. Intenta con otros términos."})})]})})};export{B as default};
