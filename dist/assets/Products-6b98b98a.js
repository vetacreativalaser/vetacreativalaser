import{a as _,r as o,u as F,j as s,m as p,L as y,B as P,s as d,t as g}from"./index-1a280ec8.js";import{H as E}from"./heart-296eae01.js";const q=()=>{const[b]=_(),[u,n]=o.useState([]),[c,j]=o.useState([]),[x,h]=o.useState(!0),[v,l]=o.useState(!1),{user:i}=F(),m=b.get("category_id");o.useEffect(()=>{(async()=>{h(!0);let r=d.from("products").select(`
          *,
          categorias:category_id ( title )
        `).eq("visible",!0).order("created_at",{ascending:!1});m&&(r=r.eq("category_id",m));const{data:a,error:t}=await r;t?(console.error("Error cargando productos:",t),g({title:"Error",description:"No se pudieron cargar los productos.",variant:"destructive"})):j(a||[]),h(!1)})()},[m]),o.useEffect(()=>{(async()=>{if(!i)return n([]);l(!0);const{data:r,error:a}=await d.from("favorites").select("product_id").eq("user_id",i.id);a?console.error("Error fetching favorites:",a):n(r.map(t=>t.product_id)),l(!1)})()},[i]);const N=async e=>{var a;if(!i){g({title:"Inicia sesión",description:"Debes iniciar sesión para añadir a favoritos.",variant:"destructive"});return}l(!0);const r=u.includes(e);if(r){const{error:t}=await d.from("favorites").delete().eq("user_id",i.id).eq("product_id",e);t||n(f=>f.filter(w=>w!==e))}else{const{error:t}=await d.from("favorites").insert([{user_id:i.id,product_id:e}]);t||n(f=>[...f,e])}g({title:r?"Eliminado de Favoritos":"Añadido a Favoritos",description:(a=c.find(t=>t.id===e))==null?void 0:a.name}),l(!1)};return x?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-black"})}):s.jsx("div",{className:"min-h-screen py-12 bg-white text-black",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[s.jsxs(p.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6,ease:"easeOut"},className:"text-center mb-12",children:[s.jsx("h1",{className:"text-4xl font-semibold mb-2",children:"PRODUCTOS"}),s.jsxs("p",{className:"text-gray-500",children:["Mostrando ",c.length," resultado(s)"]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-6 gap-y-10",children:c.map((e,r)=>{var a;return s.jsxs(p.div,{initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:{delay:r*.05,duration:.4,ease:"easeOut"},className:"group relative transition-transform hover:scale-[1.015]",children:[s.jsxs("div",{className:"w-full aspect-square bg-gray-100 overflow-hidden",children:[s.jsx(y,{to:`/productos/${e.id}`,children:s.jsx("img",{className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",alt:((a=e.image_alts)==null?void 0:a[0])||e.name,src:(()=>{try{const t=typeof e.image_urls=="string"?JSON.parse(e.image_urls):e.image_urls;return Array.isArray(t)&&t.length>0?t[0]:""}catch{return""}})()})}),i&&s.jsx(P,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 bg-white/70 hover:bg-white text-black rounded-full h-8 w-8",onClick:()=>N(e.id),disabled:v,children:v&&u.includes(e.id)?s.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-gray-500"}):s.jsx(E,{className:`h-4 w-4 ${u.includes(e.id)?"fill-red-500 text-red-500":"text-gray-500"}`,strokeWidth:1.5})})]}),s.jsxs("div",{className:"transition-colors duration-300 group-hover:bg-gray-100 px-3 py-3",children:[s.jsx("h3",{className:"text-md font-medium text-black text-left leading-snug",children:s.jsx(y,{to:`/productos/${e.id}`,children:e.name})}),s.jsx("p",{className:"mt-1 text-sm text-left text-gray-500",children:(()=>{try{const t=typeof e.price=="string"?JSON.parse(e.price):e.price;return(t==null?void 0:t.type)==="fixed"?`${t.value||t.fixedPrice} €`:"variable €"}catch{return"variable €"}})()})]})]},e.id)})}),c.length===0&&!x&&s.jsx("div",{className:"text-center py-12",children:s.jsx("p",{className:"text-lg text-gray-500",children:"No se encontraron productos."})})]})})};export{q as default};
