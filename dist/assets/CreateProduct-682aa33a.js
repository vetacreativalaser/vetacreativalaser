import{v as ie,r as o,s as y,j as e,m as ne,L as ce,B as l,I as i,t as L}from"./index-7f1f9d48.js";import{S as z,a as E,b as B,c as Q,d as b,C as le,g as de,i as pe}from"./select-663265ca.js";import{L as c}from"./label-2e4aee24.js";import{T as me}from"./textarea-c7073f45.js";import{A as ue}from"./arrow-left-22413aa0.js";import{T as C}from"./trash-2-55b83d28.js";import{C as P,P as xe}from"./package-plus-0485ee11.js";import"./index-9d6f570a.js";import"./index-2bb2294e.js";import"./chevron-down-71f633b7.js";const Pe=()=>{const F=ie(),[w,M]=o.useState(""),[U,V]=o.useState([]),[S,$]=o.useState(""),[d,H]=o.useState("fixed"),[g,I]=o.useState(""),[p,j]=o.useState([{quantity:"",price:""}]),[m,v]=o.useState([{reason:"",increment:""}]),[x,N]=o.useState([]),[k,O]=o.useState(""),[f,R]=o.useState([""]),[u,T]=o.useState(!1);o.useEffect(()=>{y.from("categorias").select("id, categoria").then(({data:a,error:s})=>{s||V(a)})},[]);const W=a=>{const s=a.target.files[0];if(!s)return;const t=new FileReader;t.onload=()=>{N(r=>[...r,{src:t.result,alt:"",text:"",crop:{x:0,y:0},zoom:1,croppedAreaPixels:null}])},t.readAsDataURL(s)},h=(a,s,t)=>{const r=[...x];r[a][s]=t,N(r)},A=a=>{N(x.filter((s,t)=>t!==a))},Z=(a,s,t)=>{h(a,"croppedAreaPixels",t)},G=()=>j([...p,{quantity:"",price:""}]),J=()=>v([...m,{reason:"",increment:""}]),K=async a=>{a.preventDefault(),T(!0);try{const s=[],t=[],r=[];for(let n=0;n<x.length;n++){const{src:Y,croppedAreaPixels:ee,alt:ae,text:se}=x[n],te=await de(Y,ee),re=await pe(te,{maxSizeMB:.2,maxWidthOrHeight:1e3,fileType:"image/webp"}),q=`producto-${Date.now()}-${n}.webp`,{error:D}=await y.storage.from("productos").upload(q,re,{contentType:"image/webp"});if(D)throw D;const{data:oe}=y.storage.from("productos").getPublicUrl(q);s.push(oe.publicUrl),t.push(ae),r.push(se)}const X=d==="fixed"?{type:"fixed",value:g}:d==="byQuantity"?{type:"byQuantity",tiers:p.filter(n=>n.quantity&&n.price)}:{type:"byReason",base:g,reasons:m.filter(n=>n.reason&&n.increment)},{error:_}=await y.from("products").insert([{name:w,category_id:S,price:X,image_urls:s,image_alts:t,image_texts:r,full_description:k,specifications:f.filter(Boolean)}]);if(_)throw _;L({title:"Producto creado",description:w}),F("/admin/dashboard?tab=products")}catch(s){L({title:"Error",description:s.message,variant:"destructive"})}finally{T(!1)}};return e.jsx("div",{className:"min-h-screen py-8 px-4 sm:px-6 lg:px-8 bg-gray-100",children:e.jsxs(ne.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"max-w-3xl mx-auto bg-white p-8 shadow border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-3xl font-semibold text-black",children:"Crear Nuevo Producto"}),e.jsx(ce,{to:"/admin/dashboard",children:e.jsxs(l,{variant:"outline",className:"border-gray-300 text-black hover:bg-gray-100",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"})," Volver"]})})]}),e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Nombre del Producto"}),e.jsx(i,{value:w,onChange:a=>M(a.target.value),required:!0,disabled:u})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Categoría"}),e.jsxs(z,{onValueChange:$,value:S,children:[e.jsx(E,{className:"w-full mt-1",children:e.jsx(B,{placeholder:"Selecciona categoría"})}),e.jsx(Q,{children:U.map(a=>e.jsx(b,{value:String(a.id),children:a.categoria},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Tipo de Precio"}),e.jsxs(z,{onValueChange:H,value:d,children:[e.jsx(E,{className:"w-full mt-1",children:e.jsx(B,{})}),e.jsxs(Q,{children:[e.jsx(b,{value:"fixed",children:"Precio Fijo"}),e.jsx(b,{value:"byQuantity",children:"Precio por Cantidad"}),e.jsx(b,{value:"byReason",children:"Precio con Motivos"})]})]})]}),d==="fixed"&&e.jsxs("div",{children:[e.jsx(c,{children:"Precio Fijo"}),e.jsx(i,{value:g,onChange:a=>I(a.target.value),required:!0,disabled:u})]}),d==="byQuantity"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Precios por Cantidad (precio por unidad)"}),p.map((a,s)=>e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsx(i,{placeholder:"Cantidad mínima",value:a.quantity,onChange:t=>{const r=[...p];r[s].quantity=t.target.value,j(r)}}),e.jsx(i,{placeholder:"Precio por unidad",value:a.price,onChange:t=>{const r=[...p];r[s].price=t.target.value,j(r)}}),e.jsx(l,{type:"button",variant:"ghost",onClick:()=>j(p.filter((t,r)=>r!==s)),children:e.jsx(C,{})})]},s)),e.jsxs(l,{type:"button",variant:"outline",onClick:G,children:[e.jsx(P,{className:"mr-2"}),"Añadir fila"]})]}),d==="byReason"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Precio Base"}),e.jsx(i,{value:g,onChange:a=>I(a.target.value)}),e.jsx(c,{children:"Motivos de Incremento"}),m.map((a,s)=>e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsx(i,{placeholder:"Motivo",value:a.reason,onChange:t=>{const r=[...m];r[s].reason=t.target.value,v(r)}}),e.jsx(i,{placeholder:"Incremento (€)",value:a.increment,onChange:t=>{const r=[...m];r[s].increment=t.target.value,v(r)}}),e.jsx(l,{type:"button",variant:"ghost",onClick:()=>v(m.filter((t,r)=>r!==s)),children:e.jsx(C,{})})]},s)),e.jsxs(l,{type:"button",variant:"outline",onClick:J,children:[e.jsx(P,{className:"mr-2"}),"Añadir motivo"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{children:"Imágenes del Producto"}),x.map((a,s)=>e.jsxs("div",{className:"border p-2 bg-gray-50",children:[e.jsx("div",{className:"relative w-full h-60",children:e.jsx(le,{image:a.src,crop:a.crop,zoom:a.zoom,aspect:1/1,onCropChange:t=>h(s,"crop",t),onCropComplete:(t,r)=>Z(s,t,r),onZoomChange:t=>h(s,"zoom",t)})}),e.jsx(i,{placeholder:"Alt",value:a.alt,onChange:t=>h(s,"alt",t.target.value),className:"mt-2"}),e.jsx(i,{placeholder:"Texto",value:a.text,onChange:t=>h(s,"text",t.target.value),className:"mt-2"}),e.jsxs(l,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>A(s),children:[e.jsx(C,{className:"mr-1 w-4 h-4"}),"Eliminar"]})]},s)),e.jsx(i,{type:"file",accept:"image/*",onChange:W})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Descripción Completa"}),e.jsx(me,{rows:5,value:k,onChange:a=>O(a.target.value),disabled:u})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Especificaciones"}),f.map((a,s)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(i,{value:a,onChange:t=>{const r=[...f];r[s]=t.target.value,R(r)}}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>A(s),children:e.jsx(C,{})})]},s)),e.jsxs(l,{type:"button",variant:"outline",onClick:()=>R([...f,""]),children:[e.jsx(P,{className:"mr-2"}),"Añadir"]})]}),e.jsxs(l,{type:"submit",className:"w-full bg-black text-white py-3",disabled:u,children:[u?e.jsx("span",{className:"animate-spin h-5 w-5 border-b-2 border-white rounded-full mr-2"}):e.jsx(xe,{className:"mr-2 h-5 w-5"}),u?"Creando...":"Crear Producto"]})]})]})})};export{Pe as default};
