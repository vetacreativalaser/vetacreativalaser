import{c as W,r as o,j as e,m as ge,I as T,B as A,e as fe,s as g,f as je,u as ye,L as be,t as H}from"./index-398056f1.js";import{C as le,a as de,S as ve,P as Ne,N as we,b as Se}from"./pagination-090a5c2a.js";import{L as z}from"./label-5befe9e8.js";import{T as me}from"./textarea-bd517421.js";import{S as G,D as Ce,R as te,P as _e,O as ke,C as Pe}from"./dialog-7d034cda.js";import{S as re,a as ie,b as ne,c as oe,d as B,C as Ie,g as Ee,i as Ae}from"./select-0ae0f10d.js";import{T as V}from"./trash-2-b64ae736.js";import{A as qe}from"./arrow-left-a4e4d157.js";import{P as ze}from"./pencil-60e0a76b.js";import{H as Le}from"./heart-8ddca09c.js";import"./index-ca2bc43f.js";import"./index-815812cc.js";import"./chevron-down-ba57ce6e.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=W("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=W("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=W("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=W("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),Oe=({images:c=[],alts:x=[],name:r="Producto"})=>{const[I,v]=o.useState(0),p=c.length,E=S=>v(S),L=()=>{v(S=>(S-1+p)%p)},R=()=>{v(S=>(S+1)%p)};return e.jsxs(ge.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},transition:{duration:.5},children:[e.jsxs("div",{className:"relative w-full aspect-square bg-gray-100 overflow-hidden",children:[e.jsx("img",{className:"w-full h-full object-cover",alt:x[I]||r,src:c[I]}),c.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:L,className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-70 rounded-full p-1 shadow hover:bg-opacity-90",children:e.jsx(le,{className:"h-5 w-5 text-black"})}),e.jsx("button",{onClick:R,className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-70 rounded-full p-1 shadow hover:bg-opacity-90",children:e.jsx(de,{className:"h-5 w-5 text-black"})})]})]}),c.length>1&&e.jsx("div",{className:"grid grid-cols-4 gap-2 mt-4",children:c.map((S,N)=>e.jsx("div",{className:`aspect-square bg-gray-100 cursor-pointer border ${N===I?"border-black":"border-transparent"} hover:border-black`,onClick:()=>E(N),children:e.jsx("img",{className:"w-full h-full object-cover",alt:x[N]||`${r} - vista ${N+1}`,src:S})},N))})]})},De=({user:c,productId:x,newReview:r,setNewReview:I,refreshReviews:v})=>{const[p,E]=o.useState(!1),[L,R]=o.useState([]),S=o.useRef(),N=async u=>{const P=Array.from(u.target.files).slice(0,6),C=await Promise.all(P.map(async l=>{const k=await fe(l,.7);return new File([k],`${Date.now()}_${l.name}.webp`,{type:"image/webp"})}));R(C)},D=async u=>{u.preventDefault(),E(!0);try{let P=[];L.length>0&&(P=await Promise.all(L.map(async a=>{const{data:m,error:f}=await g.storage.from("reviews").upload(`review-images/${c.id}/${a.name}`,a,{cacheControl:"3600",upsert:!1});if(f)throw f;const{data:h}=g.storage.from("reviews").getPublicUrl(`review-images/${c.id}/${a.name}`);return h.publicUrl})));const{error:C}=await g.from("reviews").insert({user_id:c.id,product_id:x,content:r.comment,rating:r.rating,image_urls:P});if(C)throw C;const{data:l,error:k}=await g.from("profiles").select("points, name").eq("id",c.id).single();if(!k&&l){const s=(l.points||0)+5;await g.from("profiles").update({points:s}).eq("id",c.id);const{data:{session:a}}=await g.auth.getSession();await fetch("https://dspsrnprvrpjrkicxiso.functions.supabase.co/send-points-update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a==null?void 0:a.access_token}`},body:JSON.stringify({email:c.email,name:l.name,points:s,changeType:"gain"})})}I({comment:"",rating:0}),R([]),v()}catch(P){console.error("Error al enviar la reseña:",P)}finally{E(!1)}};return c?e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"comment",children:"Tu reseña"}),e.jsx(me,{id:"comment",value:r.comment,onChange:u=>I({...r,comment:u.target.value}),placeholder:"Escribe tu opinión sobre el producto...",required:!0})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"rating",children:"Valoración"}),e.jsx("div",{className:"flex space-x-1",children:[1,2,3,4,5].map(u=>e.jsx(G,{className:`w-6 h-6 cursor-pointer ${u<=r.rating?"text-yellow-400":"text-gray-300"}`,onClick:()=>I({...r,rating:u}),fill:u<=r.rating?"currentColor":"none"},u))})]}),e.jsxs("div",{children:[e.jsxs(z,{htmlFor:"images",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Te,{className:"w-5 h-5"})," Añadir imágenes (máx 6)"]}),e.jsx(T,{id:"images",type:"file",accept:"image/*",multiple:!0,onChange:N,ref:S,className:"hidden"}),e.jsx("div",{className:"flex gap-2 mt-2 overflow-x-auto",children:L.map((u,P)=>e.jsx("img",{src:URL.createObjectURL(u),alt:"preview",className:"w-20 h-20 object-cover rounded border"},P))})]}),e.jsx(A,{type:"submit",disabled:p,className:"w-full",children:p?"Enviando...":e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"})," Enviar reseña"]})})]}):e.jsx("p",{className:"text-center text-gray-500",children:"Inicia sesión para dejar una reseña."})};const Ue=({reviews:c,user:x,refreshReviews:r})=>{var k;const[I,v]=o.useState(null),[p,E]=o.useState(null),[L,R]=o.useState({}),[S,N]=o.useState([]),[D,u]=o.useState(typeof window<"u"?window.innerWidth:1200);o.useEffect(()=>{const s=()=>u(window.innerWidth);return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),o.useEffect(()=>{const s=async()=>{const m=[...new Set(c.map(_=>_.user_id))],{data:f,error:h}=await g.from("profiles").select("id, email, name").in("id",m);if(!h&&f){const _={};f.forEach(w=>{_[w.id]={email:w.email,name:w.name}}),R(_)}},a=[];c.forEach(m=>{const f=typeof m.image_urls=="string"?JSON.parse(m.image_urls):m.image_urls;Array.isArray(f)&&f.forEach(h=>{a.push({url:h,review:m})})}),N(a),c.length>0&&s()},[c]);const P=(s,a)=>{const m=typeof s.image_urls=="string"?JSON.parse(s.image_urls):s.image_urls,f=S.findIndex(h=>h.review.id===s.id&&m[a]===h.url);v(f),E(s)},C=()=>{v(null),E(null)},l=async s=>{if(window.confirm("¿Seguro que quieres eliminar esta reseña?"))try{const a=typeof s.image_urls=="string"?JSON.parse(s.image_urls):s.image_urls;if(Array.isArray(a)&&a.length>0){const h=a.map(_=>decodeURIComponent(new URL(_).pathname.split("/storage/v1/object/public/reviews/")[1]));h.length>0&&await g.storage.from("reviews").remove(h)}await g.from("reviews").delete().eq("id",s.id);const{data:m,error:f}=await g.from("profiles").select("points, name").eq("id",x.id).single();if(!f&&m){const h=Math.max(0,m.points-5);await g.from("profiles").update({points:h}).eq("id",x.id);const{data:{session:_}}=await g.auth.getSession();await fetch("https://dspsrnprvrpjrkicxiso.functions.supabase.co/send-points-update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_==null?void 0:_.access_token}`},body:JSON.stringify({email:x.email,name:m.name,points:h,changeType:"lose"})})}r()}catch(a){console.error("Error al eliminar reseña:",a)}};return e.jsxs("div",{className:"pt-10 pb-10 min-h-screen space-y-8",children:[c.map(s=>{var w,U;const a=typeof s.image_urls=="string"?JSON.parse(s.image_urls):s.image_urls,m=((U=(w=L[s.user_id])==null?void 0:w.name)==null?void 0:U.split(" ").slice(0,2).join(" "))||"Usuario",f=(a==null?void 0:a.slice(0,2))||[],h=(a==null?void 0:a.length)>2?a.length-2:0,_=D<500;return e.jsx("div",{className:"bg-white rounded-xl border shadow-sm p-4 select-none",children:e.jsxs("div",{className:`flex ${_?"flex-col":"flex-row items-start"} gap-4`,children:[e.jsxs("div",{className:"flex-1 min-w-0 space-y-2 overflow-hidden",children:[e.jsx("p",{className:"text-sm font-semibold text-black truncate",children:m}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(b=>e.jsx(G,{className:`w-4 h-4 ${b<=s.rating?"text-yellow-400":"text-gray-300"}`,fill:b<=s.rating?"currentColor":"none"},b))}),(x==null?void 0:x.id)===s.user_id&&e.jsx(A,{size:"icon",variant:"ghost",onClick:()=>l(s),children:e.jsx($e,{className:"w-4 h-4 text-red-500"})})]}),e.jsx("p",{className:"text-sm text-gray-700 text-justify break-words whitespace-pre-wrap",children:s.content})]}),Array.isArray(a)&&a.length>0&&e.jsx("div",{className:`image-grid-2 ${_?"justify-start":"justify-center items-center self-center"}`,children:f.map((b,j)=>e.jsxs("div",{className:"image-container",children:[e.jsx("img",{src:b,onClick:()=>P(s,j),className:"review-image",alt:`img-${j}`,draggable:!1}),j===f.length-1&&h>0&&e.jsxs("div",{className:"image-overlay",onClick:()=>P(s,j),children:["+",h]})]},j))})]})},s.id)}),I!==null&&e.jsx(Ce,{open:!0,onOpenChange:C,children:e.jsx("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center",onClick:C,children:e.jsxs("div",{className:"bg-white rounded shadow-lg max-w-3xl w-full p-4",onClick:s=>s.stopPropagation(),children:[e.jsxs(ve,{initialSlide:I,modules:[Ne,we],pagination:{clickable:!0},navigation:{nextEl:".custom-swiper-next",prevEl:".custom-swiper-prev"},allowTouchMove:!0,className:"mb-4 select-none relative",onSlideChange:({activeIndex:s})=>{var m;const a=(m=S[s])==null?void 0:m.review;(a==null?void 0:a.id)!==(p==null?void 0:p.id)&&E(a)},children:[S.map((s,a)=>e.jsx(Se,{children:e.jsx("img",{src:s.url,alt:`slide-${a}`,className:"w-full h-auto max-h-[70vh] object-contain mx-auto select-none",draggable:!1})},a)),e.jsx("button",{className:"custom-swiper-prev absolute left-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-70 rounded-full p-1 shadow hover:bg-opacity-90 z-10",children:e.jsx(le,{className:"h-5 w-5 text-black"})}),e.jsx("button",{className:"custom-swiper-next absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-70 rounded-full p-1 shadow hover:bg-opacity-90 z-10",children:e.jsx(de,{className:"h-5 w-5 text-black"})})]}),p&&e.jsxs("div",{className:"text-center text-sm",children:[e.jsx("p",{className:"font-semibold text-black mb-1",children:((k=L[p.user_id])==null?void 0:k.name)||"Usuario"}),e.jsx("div",{className:"flex justify-center gap-1 mb-1",children:[1,2,3,4,5].map(s=>e.jsx(G,{className:`w-4 h-4 ${s<=p.rating?"text-yellow-400":"text-gray-300"}`,fill:s<=p.rating?"currentColor":"none"},s))}),e.jsx("p",{className:"text-justify px-2",children:p.content})]})]})})})]})},Me=c=>{try{return decodeURIComponent(c)}catch{return c}},ce=c=>{try{const x=typeof c=="string"?JSON.parse(c):c;return Array.isArray(x)?x.map(Me):[]}catch{return[]}},Je=({open:c,onOpenChange:x,product:r,onUpdated:I})=>{var Z,K,X,Y,ee;const[v,p]=o.useState([]),[E,L]=o.useState(r.name||""),[R,S]=o.useState(r.full_description||""),[N,D]=o.useState(((Z=r.price)==null?void 0:Z.type)||"fixed"),[u,P]=o.useState(((K=r.price)==null?void 0:K.value)||((X=r.price)==null?void 0:X.base)||""),[C,l]=o.useState(((Y=r.price)==null?void 0:Y.tiers)||[{quantity:"",price:""}]),[k,s]=o.useState(((ee=r.price)==null?void 0:ee.reasons)||[{reason:"",increment:""}]),[a,m]=o.useState(r.specifications||[""]),[f,h]=o.useState(r.category_id||""),[_,w]=o.useState([]),[U,b]=o.useState(!1);o.useEffect(()=>{const t=ce(r.image_alts),n=ce(r.image_texts),i=(r.image_urls||[]).map((d,M)=>({src:d,alt:t[M]||"",text:n[M]||"",crop:{x:0,y:0},zoom:1,croppedAreaPixels:null,existing:!0}));p(i)},[r]),o.useEffect(()=>{g.from("categorias").select("id, categoria").then(({data:t})=>{t&&w(t)})},[]);const j=(t,n,i)=>{const d=[...v];d[t][n]=i,p(d)},q=(t,n,i)=>{j(t,"croppedAreaPixels",i)},y=t=>{p(v.filter((n,i)=>i!==t))},F=t=>{const n=t.target.files[0];if(!n)return;const i=new FileReader;i.onload=()=>{p([...v,{src:i.result,alt:"",text:"",crop:{x:0,y:0},zoom:1,croppedAreaPixels:null,existing:!1}])},i.readAsDataURL(n)},$=()=>l([...C,{quantity:"",price:""}]),Q=()=>s([...k,{reason:"",increment:""}]),pe=async()=>{b(!0);try{const t=[],n=[],i=[];for(let J=0;J<v.length;J++){const O=v[J];if(O.existing)t.push(O.src),n.push(O.alt),i.push(O.text);else{const ue=await Ee(O.src,O.croppedAreaPixels),xe=await Ae(ue,{maxSizeMB:.2,maxWidthOrHeight:1e3,fileType:"image/webp"}),se=`producto-${Date.now()}-${J}.webp`,{error:ae}=await g.storage.from("productos").upload(se,xe,{contentType:"image/webp"});if(ae)throw ae;const{data:he}=g.storage.from("productos").getPublicUrl(se);t.push(he.publicUrl),n.push(O.alt),i.push(O.text)}}const d=N==="fixed"?{type:"fixed",value:u}:N==="byQuantity"?{type:"byQuantity",tiers:C}:{type:"byReason",base:u,reasons:k},{error:M}=await g.from("products").update({name:E,full_description:R,image_urls:t,image_alts:n,image_texts:i,specifications:a,price:d,category_id:f}).eq("id",r.id);if(M)throw M;I(),x(!1)}catch(t){console.error("❌ Error actualizando producto:",t)}finally{b(!1)}};return e.jsxs(te,{open:c,onOpenChange:x,children:[e.jsx(te,{open:c,onOpenChange:x,children:e.jsxs(_e,{children:[e.jsx(ke,{className:"fixed inset-0 bg-black/50 z-50"}),e.jsxs(Pe,{className:"fixed top-1/2 left-1/2 bg-white rounded-lg p-6 w-full max-w-3xl transform -translate-x-1/2 -translate-y-1/2 z-50 overflow-y-auto max-h-[90vh]",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Editar Producto"}),e.jsx(z,{children:"Nombre"}),e.jsx(T,{value:E,onChange:t=>L(t.target.value),className:"mb-4"}),e.jsx(z,{children:"Descripción"}),e.jsx(me,{rows:4,value:R,onChange:t=>S(t.target.value),className:"mb-4"}),e.jsx(z,{children:"Categoría"}),e.jsxs(re,{value:f,onValueChange:h,children:[e.jsx(ie,{className:"w-full mt-1 mb-4",children:e.jsx(ne,{placeholder:"Selecciona categoría"})}),e.jsx(oe,{children:_.map(t=>e.jsx(B,{value:String(t.id),children:t.categoria},t.id))})]}),e.jsx(z,{children:"Tipo de Precio"}),e.jsxs(re,{value:N,onValueChange:D,children:[e.jsx(ie,{className:"w-full mt-1 mb-4",children:e.jsx(ne,{})}),e.jsxs(oe,{children:[e.jsx(B,{value:"fixed",children:"Precio Fijo"}),e.jsx(B,{value:"byQuantity",children:"Precio por Cantidad"}),e.jsx(B,{value:"byReason",children:"Precio con Motivos"})]})]}),N==="fixed"&&e.jsxs("div",{className:"mb-4",children:[e.jsx(z,{children:"Precio Fijo"}),e.jsx(T,{value:u,onChange:t=>P(t.target.value)})]}),N==="byQuantity"&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx(z,{children:"Precios por Cantidad"}),C.map((t,n)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(T,{placeholder:"Cantidad mínima",value:t.quantity,onChange:i=>{const d=[...C];d[n].quantity=i.target.value,l(d)}}),e.jsx(T,{placeholder:"Precio por unidad",value:t.price,onChange:i=>{const d=[...C];d[n].price=i.target.value,l(d)}}),e.jsx(A,{type:"button",variant:"ghost",onClick:()=>l(C.filter((i,d)=>d!==n)),children:e.jsx(V,{})})]},n)),e.jsx(A,{type:"button",variant:"outline",onClick:$,children:"Añadir fila"})]}),N==="byReason"&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx(z,{children:"Precio Base"}),e.jsx(T,{value:u,onChange:t=>P(t.target.value)}),e.jsx(z,{children:"Motivos"}),k.map((t,n)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(T,{placeholder:"Motivo",value:t.reason,onChange:i=>{const d=[...k];d[n].reason=i.target.value,s(d)}}),e.jsx(T,{placeholder:"Incremento (€)",value:t.increment,onChange:i=>{const d=[...k];d[n].increment=i.target.value,s(d)}}),e.jsx(A,{type:"button",variant:"ghost",onClick:()=>s(k.filter((i,d)=>d!==n)),children:e.jsx(V,{})})]},n)),e.jsx(A,{type:"button",variant:"outline",onClick:Q,children:"Añadir motivo"})]}),e.jsx(z,{children:"Especificaciones"}),a.map((t,n)=>e.jsxs("div",{className:"flex space-x-2 mb-2",children:[e.jsx(T,{value:t,onChange:i=>{const d=[...a];d[n]=i.target.value,m(d)}}),e.jsx(A,{type:"button",variant:"ghost",size:"icon",onClick:()=>m(a.filter((i,d)=>d!==n)),children:e.jsx(V,{})})]},n)),e.jsx(A,{type:"button",variant:"outline",onClick:()=>m([...a,""]),children:"Añadir especificación"}),e.jsxs("div",{className:"mt-6",children:[e.jsx(z,{children:"Imágenes"}),e.jsxs("div",{className:"space-y-4",children:[v.map((t,n)=>e.jsxs("div",{className:"bg-gray-100 border p-2",children:[e.jsx("div",{className:"relative w-full h-48",children:t.existing?e.jsx("img",{src:t.src,alt:t.alt,className:"w-full h-full object-cover"}):e.jsx(Ie,{image:t.src,crop:t.crop,zoom:t.zoom,aspect:1/1,onCropChange:i=>j(n,"crop",i),onCropComplete:(i,d)=>q(n,i,d),onZoomChange:i=>j(n,"zoom",i)})}),e.jsx(T,{placeholder:"Alt",value:t.alt,onChange:i=>j(n,"alt",i.target.value),className:"mt-2"}),e.jsx(T,{placeholder:"Texto",value:t.text,onChange:i=>j(n,"text",i.target.value),className:"mt-2"}),e.jsxs(A,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>y(n),children:[e.jsx(V,{className:"mr-1 w-4 h-4"}),"Eliminar"]})]},n)),e.jsx(T,{type:"file",accept:"image/*",onChange:F})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(A,{variant:"outline",onClick:()=>x(!1),children:"Cancelar"}),e.jsx(A,{onClick:pe,disabled:U,children:U?"Guardando...":"Guardar Cambios"})]})]})]})}),"    "]})},ts=()=>{const{id:c}=je(),x=parseInt(c),{user:r}=ye(),[I,v]=o.useState(!1),[p,E]=o.useState(!1),[L,R]=o.useState([]),[S,N]=o.useState({rating:0,comment:"",name:""}),[D,u]=o.useState(!1),[P,C]=o.useState(!1),[l,k]=o.useState(null),[s,a]=o.useState(!0),m=async b=>{C(!0);const{data:j,error:q}=await g.from("reviews").select("*").eq("product_id",b).order("created_at",{ascending:!1});q||R(j||[]),C(!1)};o.useEffect(()=>{(async()=>{a(!0);const{data:j,error:q}=await g.from("products").select("*");if(q){H({title:"Error",description:"No se pudieron cargar los productos.",variant:"destructive"}),a(!1);return}const y=j.find($=>String($.id)===String(x));if(!y){k(null),a(!1);return}const F={...y,image_urls:typeof y.image_urls=="string"?JSON.parse(y.image_urls):y.image_urls,image_alts:typeof y.image_alts=="string"?JSON.parse(y.image_alts):y.image_alts,specifications:typeof y.specifications=="string"?JSON.parse(y.specifications):y.specifications,price:typeof y.price=="string"?JSON.parse(y.price):y.price};if(k(F),await m(F.id),r){u(!0);const{data:$,error:Q}=await g.from("favorites").select("*").eq("user_id",r.id).eq("product_id",F.id).maybeSingle();Q||E(!!$),u(!1)}a(!1)})()},[x,r]);const f=async()=>{if(!r)return H({title:"Inicia sesión",description:"Debes iniciar sesión para añadir a favoritos.",variant:"destructive"});u(!0),p?await g.from("favorites").delete().eq("user_id",r.id).eq("product_id",l.id):await g.from("favorites").insert([{user_id:r.id,product_id:l.id}]),E(!p),u(!1)},h=()=>{const b=window.location.href;navigator.share&&/Mobi|Android/i.test(navigator.userAgent)?navigator.share({title:document.title,url:b}).catch(()=>{}):(navigator.clipboard.writeText(b),H({title:"Enlace copiado",description:"Se ha copiado el enlace al portapapeles."}))};if(s)return e.jsx("p",{className:"text-center py-8",children:"Cargando producto..."});if(!l)return e.jsx("p",{className:"text-center py-8",children:"Producto no encontrado"});const _=Array.isArray(l.image_alts)?l.image_alts:[],w=l.price,U=()=>{var b,j;if(!w||!w.type)return e.jsx("p",{className:"text-gray-500",children:"Precio variable"});if(w.type==="fixed")return e.jsxs("p",{className:"text-xl",children:[w.value," €"]});if(w.type==="byQuantity"){const q=[...w.tiers].sort((F,$)=>parseFloat(F.price)-parseFloat($.price)),y=(b=q==null?void 0:q[0])==null?void 0:b.price;return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xl",children:["Desde ",y," €"]}),e.jsx("ul",{className:"mt-1 text-sm list-disc pl-4",children:q.map((F,$)=>e.jsxs("li",{children:[F.quantity,"+ unidades: ",F.price," €/ud"]},$))})]})}if(w.type==="byReason")return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xl",children:["Desde ",w.base," euros"]}),e.jsx("ul",{className:"mt-1 text-sm list-disc pl-4",children:(j=w.reasons)==null?void 0:j.map((q,y)=>e.jsxs("li",{children:["+",q.increment," € por ",q.reason]},y))})]})};return e.jsxs("div",{className:"container py-8",children:[e.jsxs(be,{to:"/productos",className:"flex items-center text-sm text-gray-600 hover:text-gray-800 mb-4",children:[e.jsx(qe,{className:"w-4 h-4 mr-1"}),"Volver a productos"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx(Oe,{images:l.image_urls||[],alts:_,name:l.name,infinite:!0}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-semibold text-black mr-2",children:l.name}),(r==null?void 0:r.email)==="vetacreativalaser@gmail.com"&&e.jsx(A,{variant:"outline",size:"icon",onClick:()=>v(!0),children:e.jsx(ze,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsx(A,{variant:"ghost",size:"icon",onClick:f,disabled:D,children:e.jsx(Le,{className:p?"fill-red-500 text-red-500":"text-gray-500",strokeWidth:1.5})}),e.jsx(A,{variant:"ghost",size:"icon",onClick:h,children:e.jsx(Fe,{className:"text-gray-500"})})]})]}),e.jsx(Je,{open:I,onOpenChange:v,product:l,onUpdated:()=>window.location.reload()}),e.jsx("div",{className:"mb-4",children:U()}),e.jsxs("div",{className:"text-justify",children:[e.jsx("h2",{className:"font-semibold text-lg mb-1",children:"Descripción"}),e.jsx("p",{children:l.full_description}),l.specifications&&l.specifications.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-semibold text-lg mt-6 mb-2",children:"Especificaciones"}),e.jsx("ul",{className:"list-disc pl-5",children:l.specifications.map((b,j)=>e.jsx("li",{children:b},j))})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-md text-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Cómo Comprar"}),e.jsx("p",{children:"¡Gracias por tu interés! Al ser una empresa pequeña y artesanal, gestionamos los pedidos de forma personalizada."}),e.jsxs("ol",{className:"list-decimal pl-5 mt-2 space-y-1",children:[e.jsx("li",{children:"Contacta con nosotros a través de WhatsApp o email."}),e.jsx("li",{children:"Indícanos el producto que te interesa y cualquier personalización."}),e.jsx("li",{children:"Te confirmaremos los detalles y el precio final."}),e.jsx("li",{children:"El pago se realiza de forma segura por Bizum o transferencia."})]}),e.jsx("p",{className:"mt-2 italic text-xs text-gray-500",children:"¡Soy una persona fiable! Puedes comprobar las reseñas de otros clientes."})]})]})]})]}),e.jsxs("div",{className:"mt-12",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Opiniones"}),e.jsx(De,{productId:l.id,user:r,newReview:S,setNewReview:N,refreshReviews:()=>m(l.id)}),e.jsx(Ue,{reviews:L,user:r,refreshReviews:()=>m(l.id)})]})]})};export{ts as default};
